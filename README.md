# UDP流量测试工具

一个支持多源IP和多目标IP的UDP流量测试工具，能够实现流量平均负载分配。

## 功能特性

- 支持多个源IP地址
- 支持多个目标IP地址
- 自动流量平均负载分配
- 实时带宽控制
- 总流量限制
- 多线程并发发送
- 实时统计报告
- 配置文件热重载

## 流量分配算法

程序会自动计算每个连接的流量限制：

- **总连接数** = 源IP数量 × 目标IP数量
- **每个连接流量限制** = 总流量限制 ÷ 总连接数
- **每个连接带宽限制** = 总带宽限制 ÷ 总连接数

例如：
- 3个源IP + 3个目标IP = 9个连接
- 10GB总流量 → 每个连接约1.11GB
- 10Gbps总带宽 → 每个连接约1.11Gbps

## 配置文件格式

```json
{
    "source_ips": ["192.168.1.100", "192.168.1.101", "192.168.1.102"],
    "target_ips": ["10.0.0.10", "10.0.0.11", "10.0.0.12"],
    "target_port": 8080,
    "bandwidth": 1073741824,
    "total_bytes": 10737418240,
    "thread_count": 4,
    "packet_size": 1024,
    "config_file": "config.json",
    "reload_interval": 30,
    "log_dir": "logs"
}
```

### 配置参数说明

- `source_ips`: 源IP地址列表
- `target_ips`: 目标IP地址列表
- `target_port`: 目标端口
- `bandwidth`: 总带宽限制 (bytes/s)
- `total_bytes`: 总流量限制 (bytes)
- `thread_count`: 每个连接的线程数量
- `packet_size`: 数据包大小 (bytes)
- `config_file`: 配置文件路径
- `reload_interval`: 配置重载间隔 (秒)
- `log_dir`: 日志目录

## 使用方法

```bash
# 使用默认配置文件
go run main.go

# 指定配置文件
go run main.go config.json
```

## 日志输出

程序会输出详细的运行日志，包括：

- 连接创建信息
- 线程启动信息
- 定期统计报告
- 错误信息

## 示例

假设配置了3个源IP和3个目标IP，总共9个连接：

```
创建 9 个连接，每个连接流量限制: 1193046471 bytes, 带宽限制: 119304647 bytes/s
创建连接: 192.168.1.100 -> 10.0.0.10:8080
创建连接: 192.168.1.100 -> 10.0.0.11:8080
创建连接: 192.168.1.100 -> 10.0.0.12:8080
...
线程 0-0 开始工作: 192.168.1.100 -> 10.0.0.10:8080
线程 0-1 开始工作: 192.168.1.100 -> 10.0.0.10:8080
...
总发送流量: 1073741824 bytes (1024.00 MB)
连接 0 (192.168.1.100 -> 10.0.0.10:8080): 119304647 bytes
连接 1 (192.168.1.100 -> 10.0.0.11:8080): 119304647 bytes
...
``` 